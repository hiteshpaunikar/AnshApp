<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Ansh App">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="images/ansh.png">

  <link href="css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script src="js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="js/app.js">  </script>

  <style>
    .card {
      border-radius: 10px;
      cursor: pointer;
      margin-bottom:0.5rem!important;
    }

    .card-header{
      background-color: rgb(54, 54, 179);
      color: white;
    }
    .card-title {
      text-align: center;
      font-weight: bold;
      font-size: 1rem;
      font-family: Arial, sans-serif;

    }

    .card-img-top {
      height: "100";
      width: "50";
      object-fit: contain;
    }

    ul {
      list-style-type: circle;
      padding-left: 1em;
      
    }
    .hidden {
      display: none;
    }

    #disciplineSelect {
      margin-top: 5px;
    }

    p{
      text-align: justify;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <!--  <h1 class="mb-4">Doctor List</h1>-->

    <div class="row pt-3 nav-wrapper" style="background-color: rgb(54, 54, 179);color: white;padding-bottom: 10px;">
      <div class="col-lg-12">
        <div class="panel " style="margin-bottom: 0px;">
          <div class="panel-content">
            <!-- DataTables -->
            <table style="width: 100%">
              <tbody>
                <tr>
                  <td align="left" style="cursor: pointer;" onclick="window.location.href='index.html'">

                    <img src="images/ic_launcher_round.png" height="50"
                      style="margin-left: 0px; padding-left: 0px; padding-right: 5px;">
                  </td>
                  <td align="center">
                    <h5 style="font-weight: bold;">
                      CHSS Doctor / Hospital / Lab List
                    </h5>
                  </td>
                  <td align="right"><img src="images/doctor.png" height="50" style="padding-left: 5px;"></td>

                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row" >
      <div class="d-none d-lg-block col-lg-12">
        <div class="container-fluid" style="text-align: center;">

          <div class="row">
          <span class="col-lg-4">
          <img src="images/doctor.png" height="300"  style="padding-top: 10px;padding-bottom: 10px">
          </span>

          <span class="col-lg-8" style="padding-left: 1rem;padding-top: 1rem;">
          
            <p style="text-align: justify;"> <b>Contributory Health Service Scheme(CHSS) </b>provides comprehensive healthcare support to ISRO employees through a network of dedicated medical facilities, including hospitals, clinics, and diagnostic laboratories. These facilities aim to ensure the well-being of ISRO's personnel and their families by offering preventive, curative, and emergency medical services.
            Key Features: <br/> 
            <ul style="list-style: disc;padding: 0px;margin: 0px;text-align: justify;">
            <li >Doctor List: ISRO medical facilities are staffed with a multidisciplinary team of healthcare professionals, including general physicians, specialists (such as cardiologists, orthopedists, and ENT specialists), and paramedical staff. The specific list of doctors varies by location.</li>
            <li >	Hospital List: ISRO operates and collaborates with hospitals to provide best facility. These hospitals cater to routine check-ups, specialized treatments, and emergencies.</li>
            <li >	Laboratory Services: Accredited diagnostic laboratories associated with ISRO facilities provide a wide range of testing services, including blood tests, imaging (X-ray, MRI, CT scans), and other advanced diagnostics essential for employee health monitoring.</li>
            
          </ul>
          
           
          </p>
          
            </span>
          </div>
        </div>
      </div>

      <div class="col-md-6 pt-1" >
        <div class="input-group">
          <input type="text" id="searchInput" class="form-control" placeholder="Search">
          <button id="voiceSearchBtn" class="btn btn-outline-secondary">
            <!--  <i class="fas fa-microphone"></i>-->

            <img src="images/mic.png" height="20" style="padding-left: 5px;">
          </button>
        </div>
      </div>

      <div class="col-md-6 pt-1 pb-1">
        <select id="filterSelect" class="form-select">
          <option value="AMODOCTORNAME">Doctor Name</option>
          <option value="DOCTORTYPE">Doctor Type</option>
          <option value="MEDICINETYPE">Doctor Category</option>
          <option value="AMOHOUSENO">Address</option>
          <option value="AMOAREANAME">Area</option>
          <option value="AMOPHONENO">Phone Number</option>
          <option value="MEDDISCIPLNAME">Specialization</option>
        </select>
        <select id="disciplineSelect" class="form-select mb-2 hidden">
          <option value="">Select Discipline</option>
        </select>
        <h5 id="searchHint" class="searchHint text-muted small pt-1" style="color: blue;"></h5>
      </div>


      <div id="doctorsList" class="container-fluid py-2" >
        <!-- Doctors will be rendered here -->
      </div>
    

    </div>
  </div>



  <script type="module">
    let doctors = [];
    let recognition = null;
    let isListening = false;
    let hintTimeout=null;
    // Fetch doctors data
    async function fetchDoctors() {
      try {
        const response = await fetch('data/DoctorsData.json');
        const data = await response.json();
        doctors = data.Doctor;
        renderDoctors(doctors);
      } catch (error) {
        console.error('Error loading doctors:', error);
      }
    }

    // Initialize speech recognition
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = function (event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('searchInput').value = transcript;
        filterDoctors();
        stopRecognition();
      };

      recognition.onerror = function (event) {
        console.error('Speech recognition error:', event.error);
        stopRecognition();
      };

      recognition.onend = function () {
        stopRecognition();
      };
    }

    function stopRecognition() {
      isListening = false;
      voiceSearchBtn.classList.remove('listening');
    }

    // Voice search button handler
    const voiceSearchBtn = document.getElementById('voiceSearchBtn');
    voiceSearchBtn.addEventListener('click', () => {
      if (recognition) {
        if (!isListening) {
          try {
            recognition.start();
            isListening = true;
            voiceSearchBtn.classList.add('listening');
          } catch (error) {
            console.error('Speech recognition error:', error);
            stopRecognition();
          }
        } else {
          recognition.stop();
          stopRecognition();
        }
      } else {
        alert('Speech recognition is not supported in your mobile.');
      }
    });

    function openGoogleMaps(geolocation) {
      
        if(!geolocation) return ;
        
        const[lat,lng]=geolocation.split(',').map(coord => coord.trim());
        
        let mapsURL = `https://www.google.com/maps?q=${lat},${lng}`;
        //window.open(mapsURL);  to open in new tab
        window.location.href=mapsURL;
    }
    
    function updateDisciplineDropdown(doctorType) {
        const disciplineSelect = document.getElementById('disciplineSelect');
        if (doctorType === 'MEDDISCIPLNAME') {
          // Get unique disciplines
          const disciplines = [...new Set(doctors.map(doctor => doctor.MEDDISCIPLNAME))].sort((a,b) => a.localeCompare(b));
          disciplineSelect.innerHTML = '<option value="">Select Discipline</option>' +
            disciplines.map(discipline => 
              `<option value="${discipline}">${discipline}</option>`
            ).join('');
          disciplineSelect.classList.remove('hidden');
        } else {
          disciplineSelect.classList.add('hidden');
          disciplineSelect.value = '';
        }
      }
    function renderDoctors(doctorsToRender) {
      const doctorsList = document.getElementById('doctorsList');
      if (doctorsToRender.length === 0) {
        doctorsList.innerHTML = `
              <div class="alert alert-info" role="alert">
                No doctors found matching your search criteria.
              </div>
            `;
        return;
      }

      doctorsList.innerHTML = doctorsToRender.map(doctor => `
            <div class="card">
              <div class="card-header" data-bs-toggle="collapse"  href='#${doctor.AMODOCTORCODE}''>
                <h5 style="margin-bottom:0px;">
                  <td align="right"><img src="images/specialist.png" height="50"> ${doctor.AMODOCTORNAME || 'N/A'}  
                  
                    <i class="fas fa-chevron-circle-down" style="float:right;margin-top:1rem"></i>
                </h5>
              </div>
              <div class="card-body" style="curser:copy">
                <!--<h3 class="h5 mb-2">${doctor.AMODOCTORNAME || 'N/A'}</h3>-->
                <p class="mb-1"><strong>Doctor Type:</strong> ${doctor.MEDDISCIPLNAME || 'N/A'}</p>
                <p class="mb-1"><strong>Doctor Area:</strong> ${doctor.AMOAREANAME || 'N/A'}</p>
                <p class="mb-1"><strong>Timings:</strong> ${doctor.AMOTIMINGS || 'N/A'}</p>
                <span id='${doctor.AMODOCTORCODE}' class="collapse" data-bs-parent="#doctorsList">
                  <p class="mb-1"><strong>Medicine Type:</strong> ${doctor.MEDICINETYPE || 'N/A'}</p>  
                <p class="mb-1" style="float:left"><a href="tel:${doctor.PRIMARYPHONE}" class="dial-link"><img src="images/call.png" height="40" style="padding-left: 0px;"> </a><strong>:</strong> ${doctor.AMOPHONENO || 'N/A'}</p>
                
                <p class="mb-0" style="float:left"><img src="images/map.png" height="40" style="padding-left: 0px;" onclick="openGoogleMaps('${doctor.GEOLOCATION || ''}')"  ><strong> :</strong> ${[doctor.AMOHOUSENO, doctor.AMOSTREET, doctor.AMOPLACE].filter(Boolean).join(', ') || 'N/A'}
                </p>
              </span>
              </div>
            </div>
          `).join('');
    }

    function updateSearchHint(filtertype) {
      const hintElement=document.getElementById("searchHint");
      const hints= {
      "MEDICINETYPE":"AMO,SPL",
      "DOCTORTYPE":"ALLOPATHY,HOMEOPATHY,AYURVEDIC",
      "AMOAREANAME":"MANINAGAR,BOPAL",
      "MEDDISCIPLNAME":"SKIN,CHILD,RADIOLOGY"
    };
    if(hintTimeout) {
      clearTimeout(hintTimeout);
    }
    hintElement.textContent=hints[filtertype] || ' ';

  hintTimeout=setTimeout(() => {
    hintElement.textContent='';
  },3000);
  }

    function filterDoctors() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filterType = document.getElementById('filterSelect').value;
      const selectedDiscipline = document.getElementById('disciplineSelect').value;
        
        let filtered = doctors;

        if (filterType === 'MEDDISCIPLNAME' && selectedDiscipline) {
          filtered = doctors.filter(doctor => 
            doctor.MEDDISCIPLNAME === selectedDiscipline
          );
        } else {
          filtered = doctors.filter(doctor => 
            Object.values(doctor).some(value => 
              value && value.toLowerCase().includes(searchTerm)
            )
          );
        }

      renderDoctors(filtered);
    }

    // Event listeners
    document.getElementById('searchInput').addEventListener('input', filterDoctors);
    document.getElementById('filterSelect').addEventListener('change', (e) => {
      document.getElementById('searchInput').value='';
      updateSearchHint(e.target.value);
      updateDisciplineDropdown(e.target.value);
      filterDoctors();
    });

    document.getElementById('disciplineSelect').addEventListener('change', (e) => {
      document.getElementById('searchInput').value='';
      filterDoctors();
    });
    window.openGoogleMaps=openGoogleMaps;
    
    // Initial fetch and render
    fetchDoctors();
  </script>
</body>

</html>